# Phase 1 – RLS Policy Matrix (Documentation Only)

## Project
**VP-Flow**

## Purpose
Define explicit Row Level Security (RLS) and permission rules per role, per entity, and per action. This document is authoritative for access control design and prevents ambiguity during implementation.

Status: Documentation only. No implementation authorized.

---

## 1. Roles (Fixed)

| Role | Description |
|---|---|
| VP | Vice President. Final authority on all data and decisions. |
| Secretary | Executive support role. Read access + operational support, no decision authority. |
| Protocol | Execution-only role for approved appointments. No access to cases. |

---

## 2. Permission Legend

| Symbol | Meaning |
|---|---|
| C | Create |
| R | Read |
| U | Update |
| D | Delete |
| X | Execute-only (status marking) |
| – | No access |

---

## 3. Users & Profiles

### Entity: `user_profiles`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | – | – | – | Managed by system/admin only |
| Read | R | R | R (self only) | Protocol may read own profile only |
| Update | U | – | – | VP can deactivate users |
| Delete | – | – | – | Not allowed |

---

## 4. Clients / Persons

### Entity: `clients`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | C | C | – | Internal registry only |
| Read | R | R | – | Protocol has no client visibility |
| Update | U | U | – | Secretary edits allowed (no deletion) |
| Delete | D | – | – | Soft-delete recommended |

---

## 5. Appointments

### Entity: `appointments`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | C | C | – | Secretary creates in pending state |
| Read | R | R | R (approved only) | Protocol sees approved/rescheduled only |
| Update (details) | U | U (limited) | – | Secretary may update logistics only |
| Approve / Reject | U | – | – | VP-only transition |
| Cancel | U | – | – | VP-only |
| Mark Completed | U | – | – | VP-only |
| Delete | – | – | – | Not allowed; use cancel |

**RLS Constraints:**
- Protocol `SELECT` only where `status = approved OR status = rescheduled`
- Secretary cannot update `status` fields related to approval

---

## 6. Appointment Attendees

### Entity: `appointment_attendees`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | C | C | – | Optional entity |
| Read | R | R | R (approved only) | Protocol sees names only |
| Update | U | U | – | |
| Delete | D | D | – | |

---

## 7. Cases

### Entity: `cases`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | C | – | – | Case activation is VP-only |
| Read | R | R | – | Secretary read-only |
| Update (content) | U | – | – | VP-only |
| Update (status) | U | – | – | Includes close/park |
| Close | U | – | – | Closed is final |
| Delete | – | – | – | Not allowed |

**RLS Constraints:**
- All cases must have `owner_user_id = VP`
- Secretary has `SELECT` only

---

## 8. Case Reminders

### Entity: `reminders`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | C | – | – | Generated by system or VP |
| Read | R | R | – | Secretary visibility for support |
| Update | – | – | – | System-managed |
| Delete | – | – | – | System-managed |

---

## 9. Protocol Events

### Entity: `protocol_events`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | – | – | X | Execution-only |
| Read | R | R | R | |
| Update | – | – | X | Arrival / assist / no-show |
| Delete | – | – | – | Not allowed |

---

## 10. Documents / PDFs

### Entity: `documents`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Generate | C | C (if authorized) | – | Manual trigger |
| Read | R | R (if authorized) | – | Internal archive |
| Delete | – | – | – | Not allowed |

---

## 11. Notifications

### Entity: `notifications`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | – | – | – | System-only |
| Read | R | R | R | Role-filtered |
| Update (read) | U | U | U | Mark as read |
| Delete | – | – | – | Auto-expire |

---

## 12. Audit Events

### Entity: `audit_events`

| Action | VP | Secretary | Protocol | Notes |
|---|---|---|---|---|
| Create | – | – | – | System-only (triggers/functions) |
| Read | R | R (limited) | – | Secretary read-only summary |
| Update | – | – | – | Immutable |
| Delete | – | – | – | Immutable |

---

## 13. Cross-Cutting RLS Rules (Non-Negotiable)

1. All UPDATE/DELETE operations require role validation.
2. Approval-related transitions are VP-only.
3. Protocol never sees cases or client notes.
4. Closed cases are immutable.
5. Audit events cannot be modified or removed.

---

## 14. Phase Gate Status

Phase 1 (RLS Policy Matrix) – COMPLETE (documentation)

**Hard Stop:** Await explicit authorization for Phase 2 (Implementation Planning or Execution).

---

**Await Further Instructions.**

